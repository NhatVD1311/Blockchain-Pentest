import os
import time

contract_chua_scan = '/oyente/oyente/dataset/1'
scan = '/oyente/oyente/dataset/scan'

if not os.path.isdir(scan):
    os.mkdir(scan)

os.system('chmod 777 /oyente/oyente/dataset/scan')

contracts = os.listdir(contract_chua_scan)
for i in range(len(contracts)):
# for contract in contracts:
    if '.sol' in contracts[i] or '.SOL' in contracts[i]:
        contract_path = os.path.join(contract_chua_scan, contracts[i])
        out_file = os.path.join(scan, contracts[i][:-4] + '.txt')

        print('\n\n===============================================================')
        print(i, contracts[i])

        # contract_version = getVersionPragma(contract_path)

        #print(contract_version)
        
        start = time.time()

        scan_cmd = 'timeout 3m python oyente.py -s ' + contract_path + '>' + out_file
        os.system(scan_cmd)
        end = time.time()
        print("Time scan:", end - start)
